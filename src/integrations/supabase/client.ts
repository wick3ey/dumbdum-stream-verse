
// This file is automatically generated. Do not edit it directly.
import type { Database } from './types';

// Mock client implementation to avoid the dependency
// This is a temporary solution until we can properly install @supabase/supabase-js

// Define minimal types we need for our implementation
export type Session = {
  user: User | null;
  access_token: string | null;
};

export type User = {
  id: string;
  email?: string;
  user_metadata: Record<string, any>;
};

// Create a simplified mock client
class SupabaseClient {
  private user: User | null = null;
  private session: Session | null = null;
  private listeners: Array<(event: string, session: Session | null) => void> = [];

  constructor() {
    // Try to load session from localStorage if available
    try {
      const savedSession = localStorage.getItem('supabase.auth.token');
      if (savedSession) {
        const parsed = JSON.parse(savedSession);
        this.session = parsed;
        this.user = parsed.user;
      }
    } catch (error) {
      console.error('Error loading session:', error);
    }
  }

  get auth() {
    return {
      getSession: async () => {
        return { data: { session: this.session } };
      },
      
      onAuthStateChange: (callback: (event: string, session: Session | null) => void) => {
        this.listeners.push(callback);
        return { 
          data: { 
            subscription: { 
              unsubscribe: () => {
                this.listeners = this.listeners.filter(listener => listener !== callback);
              } 
            } 
          } 
        };
      },
      
      signUp: async ({ email, password, options }: { email: string; password: string; options?: { data?: any } }) => {
        // Simulate successful signup without actually calling Supabase
        const newUser = {
          id: `user-${Date.now()}`,
          email,
          user_metadata: options?.data || {}
        };
        
        return { data: { user: newUser }, error: null };
      },
      
      signInWithPassword: async ({ email, password }: { email: string; password: string }) => {
        // Simulate successful login
        const user = {
          id: `user-${Date.now()}`,
          email,
          user_metadata: {}
        };
        
        this.user = user;
        this.session = { user, access_token: `mock-token-${Date.now()}` };
        
        // Save to localStorage to persist across page reloads
        localStorage.setItem('supabase.auth.token', JSON.stringify(this.session));
        
        // Notify listeners
        this.listeners.forEach(listener => listener('SIGNED_IN', this.session));
        
        return { data: { user, session: this.session }, error: null };
      },
      
      signOut: async () => {
        this.user = null;
        this.session = null;
        localStorage.removeItem('supabase.auth.token');
        
        // Notify listeners
        this.listeners.forEach(listener => listener('SIGNED_OUT', null));
        
        return { error: null };
      }
    };
  }

  // Add minimal implementation for other needed methods
  from(table: string) {
    // Return a chainable object with basic query methods
    return {
      select: (columns: string) => ({
        eq: (field: string, value: any) => ({
          single: async () => ({ data: null, error: null }),
          maybeSingle: async () => ({ data: null, error: null }),
          execute: async () => ({ data: [], error: null })
        }),
        order: (field: string, { ascending }: { ascending: boolean }) => ({
          limit: (n: number) => ({
            execute: async () => ({ data: [], error: null })
          }),
          execute: async () => ({ data: [], error: null })
        }),
        execute: async () => ({ data: [], error: null })
      }),
      insert: (data: any) => ({
        select: () => ({
          execute: async () => ({ data: [data], error: null })
        })
      }),
      update: (data: any) => ({
        eq: (field: string, value: any) => ({
          select: () => ({
            execute: async () => ({ data: [data], error: null })
          })
        })
      })
    };
  }

  // Add basic implementation of rpc for functions
  rpc(functionName: string, params: any) {
    return new Promise((resolve) => {
      resolve({ data: null, error: null });
    });
  }

  // Mock channel implementation
  channel(channelName: string) {
    return {
      on: (event: string, filter: any, callback: (payload: any) => void) => {
        return {
          subscribe: () => {
            // Return the channel object for chaining
            return {};
          }
        };
      }
    };
  }

  // Clean up channel subscriptions
  removeChannel(channel: any) {
    // Mock implementation, no actual cleanup needed
  }
}

// Export mock client
export const supabase = new SupabaseClient() as any;
